<!doctype html>
<html>

<head>
  <title>AI Ball</title>
  <link rel="stylesheet" type="text/css" href ="/css/styleAndFashion.css" />
</head>

<body>
  <div id="stadium"><canvas id="game-area" width="900" height="660" style="border:1px solid #000000;"></canvas></div>

  <script>
  </script>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let gameData = {
      teams: [],
      area: {
        size: {
          height: 0,
          width: 0
        },
        goals: []
      },
      ball: {
        size: {
          radius: 0
        },
        pos: {
          x: 0, y: 0
        }
      }
    };
    const socket = io();
    const canvas = document.getElementById('game-area');
    const ctx = canvas.getContext('2d');

    // convert from game area position to canvas position
    const toCanvasX = x => canvas.width * (x / gameData.area.size.width);
    const toCanvasY = y => canvas.height * (y / gameData.area.size.height);

    const updateCanvas = () => {
      // clear canvas
      ctx.clearRect(0, 0, gameData.area.size.width, gameData.area.size.height);
      ctx.beginPath();
      ctx.rect(toCanvasX(20), 0, toCanvasX(gameData.area.size.width-40), toCanvasY(gameData.area.size.height));
      ctx.stroke();

      // draw goals
      gameData.area.goals.forEach(goal => {
        if (goal.end == 'left') {
          ctx.beginPath();
          ctx.rect(0, toCanvasY((gameData.area.size.height-goal.size)/2), toCanvasX(20), toCanvasY(goal.size));
          ctx.stroke();
        }
        if (goal.end == 'right') {
          ctx.beginPath();
          ctx.rect(toCanvasX(gameData.area.size.width-20), toCanvasY((gameData.area.size.height-goal.size)/2), gameData.area.size.width, toCanvasY(goal.size));
          ctx.stroke();
        }
      });

      // draw players
      gameData.teams.forEach(team => {
        team.players.forEach(player => {
          ctx.beginPath();
          ctx.arc(toCanvasX(player.position.x), toCanvasY(player.position.y), 10, 0, 2 * Math.PI);
          ctx.fillStyle = team.color;
          ctx.fill();
        });
      });

      // draw ball
      ctx.beginPath();
      ctx.arc(toCanvasX(gameData.ball.pos.x), toCanvasY(gameData.ball.pos.y), gameData.ball.size, 0, 2 * Math.PI);
      ctx.fillStyle = gameData.ball.color;
      ctx.fill();

    };

    // update canvas when server sends new positions
    socket.on('new positions', function (teams) {
      gameData.teams = JSON.parse(teams);
      updateCanvas();
    });

    socket.on('area data', function (area) {
      gameData.area = JSON.parse(area);
    });

    socket.on('ball data', function (ball) {
      gameData.ball = JSON.parse(ball);
    });


    updateCanvas();
  </script>
</body>

</html>