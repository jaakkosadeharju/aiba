<!doctype html>
<html>

<head>
  <title>AI Ball</title>
  <link rel="stylesheet" type="text/css" href ="/css/styleAndFashion.css" />
</head>

<body>
  <div id="stadium"><canvas id="game-area" width="900" height="660" style="border:1px solid #000000;"></canvas></div>

  <script>
  </script>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let gameData = {
      teams: [],
      area: {
        size: {
          height: 0,
          width: 0
        },
        goals: []
      },
      ball: {
        size: 0,
        position: { x: 0, y: 0 },
        color: '#000000'
      }
    };
    const socket = io();
    const canvas = document.getElementById('game-area');
    const ctx = canvas.getContext('2d');

    // convert from game area position to canvas position
    const toCanvasX = x => ((canvas.width-40) * (x / (gameData.area.size.width)))+20;
    const toCanvasY = y => canvas.height * (y / gameData.area.size.height);

    const updateCanvas = () => {
      // clear canvas
      ctx.clearRect(toCanvasX(0)-20, toCanvasY(0), toCanvasX(gameData.area.size.width)+40, toCanvasY(gameData.area.size.height));
      ctx.beginPath();
      ctx.rect(toCanvasX(0), toCanvasY(0), toCanvasX(gameData.area.size.width-20), toCanvasY(gameData.area.size.height));
      ctx.stroke();

      // draw goals
      gameData.area.goals.forEach(goal => {
          ctx.beginPath();
          ctx.rect(toCanvasX(goal.corners.topLeft), toCanvasY(goal.corners.bottomLeft), toCanvasX(goal.corners.topRight), toCanvasY(goal.corners.bottomRight));
          ctx.stroke();
      });

      // draw players
      gameData.teams.forEach(team => {
        team.players.forEach(player => {
          ctx.beginPath();
          ctx.arc(toCanvasX(player.position.x), toCanvasY(player.position.y), player.size, 0, 2 * Math.PI);
          ctx.fillStyle = team.color;
          ctx.fill();
        });
      });

      // draw ball
      ctx.beginPath();
      ctx.arc(toCanvasX(gameData.ball.position.x), toCanvasY(gameData.ball.position.y), gameData.ball.size, 0, 2 * Math.PI);
      ctx.fillStyle = gameData.ball.color;
      ctx.fill();

    };

    // update canvas when server sends new positions
    socket.on('new positions', function (positions) {
      var positionData = JSON.parse(positions);
      gameData.teams = positionData.teams;
      gameData.ball = positionData.ball;
      console.log(gameData.ball);
      
      updateCanvas();
    });

    socket.on('area data', function (area) {
      gameData.area = JSON.parse(area);
    });

    updateCanvas();
  </script>
</body>

</html>